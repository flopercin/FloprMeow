<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MeowFlopr Casino Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            font-family: 'Press Start 2P', system-ui;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ (—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã) */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        .neon-text {
            text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #00ffff;
        }
        
        .neon-border {
            box-shadow: 0 0 10px #ff00ff, inset 0 0 10px #ff00ff;
        }

        .slot-reel { transition: all 0.1s linear; }
        
        .explosion { animation: explode 0.6s forwards; }
        @keyframes explode {
            0% { transform: scale(0.5); opacity: 1; }
            50% { transform: scale(1.5); }
            100% { transform: scale(2.0); opacity: 0; }
        }
        
        .card-hover { transition: all 0.3s; }
        .card-hover:active { transform: scale(0.95); }
        @media (min-width: 768px) {
            .card-hover:hover {
                transform: scale(1.05) rotate(1deg);
                box-shadow: 0 0 30px #ff00ff;
                z-index: 10;
            }
        }
        
        .reel {
            overflow: hidden;
            border: 4px solid #ffd700;
            background: #111;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—Å—Ç–æ–≤ */
        .toast-enter { transform: translateX(100%); opacity: 0; }
        .toast-enter-active { transform: translateX(0); opacity: 1; transition: all 0.3s ease-out; }
        .toast-exit { transform: translateX(0); opacity: 1; }
        .toast-exit-active { transform: translateX(100%); opacity: 0; transition: all 0.3s ease-in; }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç */
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #ec4899, #a855f7, #22d3ee);
        }
    </style>
</head>
<body class="bg-zinc-950 text-white overflow-x-hidden pb-20 md:pb-0">

    <div id="toast-container" class="fixed top-4 right-0 left-0 md:left-auto md:right-4 z-[200] flex flex-col gap-2 p-4 pointer-events-none"></div>

    <header class="bg-black/90 backdrop-blur-md border-b-4 border-pink-500 sticky top-0 z-40 shadow-[0_0_20px_rgba(236,72,153,0.5)]">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="w-full md:w-auto flex flex-col md:flex-row items-center gap-4">
                <div class="flex items-center gap-3">
                    <img src="https://via.placeholder.com/50/ec4899/ffffff?text=MF" alt="MeowFlopr" class="w-10 h-10 rounded-lg border-2 border-pink-500 shadow-lg shadow-pink-500/50">
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-gradient tracking-widest">MEOWFLOPR</h1>
                    </div>
                </div>
                
                <nav class="w-full md:w-auto overflow-x-auto whitespace-nowrap flex gap-6 text-[10px] md:text-xs pb-2 md:pb-0 scrollbar-hide justify-center md:justify-start">
                    <a onclick="showSection('home')" class="cursor-pointer hover:text-pink-400 transition bg-zinc-900/50 px-3 py-1 rounded-full border border-pink-500/30">–ì–õ–ê–í–ù–ê–Ø</a>
                    <a onclick="showSection('games')" class="cursor-pointer hover:text-pink-400 transition bg-zinc-900/50 px-3 py-1 rounded-full border border-pink-500/30">–ò–ì–†–´</a>
                    <a onclick="showLeaderboard()" class="cursor-pointer hover:text-pink-400 transition bg-zinc-900/50 px-3 py-1 rounded-full border border-pink-500/30">–¢–û–ü</a>
                    <a onclick="showBonus()" class="cursor-pointer hover:text-pink-400 transition bg-zinc-900/50 px-3 py-1 rounded-full border border-pink-500/30">–ë–û–ù–£–°–´</a>
                </nav>
            </div>
            
            <div class="flex items-center gap-3 md:gap-6 text-[10px] md:text-sm w-full md:w-auto justify-center">
                <div class="bg-zinc-900 px-4 py-2 rounded-full border border-emerald-400 flex items-center gap-2 font-bold shadow-[0_0_10px_rgba(52,211,153,0.2)]">
                    <span class="text-emerald-400">‚ÇΩ</span>
                    <span id="balance">0</span>
                </div>
                <div class="bg-zinc-900 px-4 py-2 rounded-full border border-purple-400 flex items-center gap-2">
                    <span class="text-purple-400">LVL</span>
                    <span id="user-level" class="font-bold text-purple-400">1</span>
                </div>
                <div onclick="showProfile()" class="flex items-center gap-2 cursor-pointer active:scale-95 transition">
                    <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center text-sm shadow-lg shadow-pink-500/50">üë§</div>
                </div>
            </div>
        </div>
    </header>

    <section id="home" class="relative min-h-[80vh] flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,#4c1d95_0%,#000_80%)]"></div>
        <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(#ec4899 1px, transparent 1px), linear-gradient(90deg, #ec4899 1px, transparent 1px); background-size: 50px 50px;"></div>
        
        <div class="text-center z-10 px-4 w-full">
            <h2 class="text-2xl md:text-5xl font-bold neon-text mb-2 md:mb-4 animate-pulse">WELCOME TO</h2>
            <h1 class="text-4xl md:text-8xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-400 mb-6 drop-shadow-[0_0_15px_rgba(236,72,153,0.8)]">MEOWFLOPR</h1>
            <p class="text-xs md:text-xl text-pink-300 max-w-2xl mx-auto leading-relaxed">
                –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ –º–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã <br class="hidden md:block"> –∏ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å –∏—Ö –∑–∞ —Å–µ–∫—É–Ω–¥—É.
            </p>
            
            <div class="mt-8 md:mt-12 flex flex-col md:flex-row justify-center gap-4 md:gap-6">
                <button onclick="showGames()" class="bg-gradient-to-r from-pink-600 to-purple-600 active:scale-95 px-8 md:px-12 py-4 md:py-6 text-lg md:text-2xl font-bold rounded-xl border-2 border-white/50 shadow-[0_0_30px_rgba(236,72,153,0.4)] transition">
                    –ò–ì–†–ê–¢–¨ üî•
                </button>
            </div>
        </div>
    </section>

    <section id="games" class="max-w-7xl mx-auto px-4 py-8 md:py-16 hidden pb-32">
        <h2 class="text-3xl md:text-5xl font-bold text-center mb-8 md:mb-12 neon-text">–ò–ì–†–´</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-10">
            <div id="game-card-slots" onclick="openGame('slots')" class="relative card-hover bg-zinc-900 rounded-3xl overflow-hidden border-2 border-yellow-400 cursor-pointer group">
                <img src="https://images.unsplash.com/photo-1596838132731-3301c3fd4317?auto=format&fit=crop&q=80" class="w-full h-48 md:h-80 object-cover opacity-80 group-hover:opacity-100 transition">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent p-6 flex flex-col justify-end">
                    <h3 class="text-xl md:text-2xl font-bold text-yellow-400 mb-1">–°–õ–û–¢–´ –ú–ï–õ–°–¢–†–û–Ø</h3>
                    <p class="text-zinc-400 text-[10px] md:text-sm">–ö–ª–∞—Å—Å–∏–∫–∞. 3 –≤ —Ä—è–¥.</p>
                </div>
            </div>
            
            <div id="game-card-epstein" onclick="openGame('epstein')" class="relative card-hover bg-zinc-900 rounded-3xl overflow-hidden border-2 border-red-500 cursor-pointer group">
                <div id="lock-epstein" class="absolute inset-0 bg-black/80 z-20 flex flex-col items-center justify-center backdrop-blur-sm hidden">
                    <i class="fas fa-lock text-4xl text-zinc-500 mb-2"></i>
                    <span class="text-xs text-red-500 font-bold">–ù–£–ñ–ï–ù 5 –£–†–û–í–ï–ù–¨</span>
                </div>
                <img src="https://images.unsplash.com/photo-1605810230434-7631ac76ec81?auto=format&fit=crop&q=80" class="w-full h-48 md:h-80 object-cover opacity-80 group-hover:opacity-100 transition">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent p-6 flex flex-col justify-end">
                    <h3 class="text-xl md:text-2xl font-bold text-red-500 mb-1">–ú–ò–ù–ù–û–ï –ü–û–õ–ï</h3>
                    <p class="text-zinc-400 text-[10px] md:text-sm">–ù–µ –Ω–∞—Ç–∫–Ω–∏—Å—å –Ω–∞ –±–æ–º–±—É</p>
                </div>
            </div>
            
            <div id="game-card-crash" onclick="openGame('crash')" class="relative card-hover bg-zinc-900 rounded-3xl overflow-hidden border-2 border-cyan-400 cursor-pointer group">
                <div id="lock-crash" class="absolute inset-0 bg-black/80 z-20 flex flex-col items-center justify-center backdrop-blur-sm hidden">
                    <i class="fas fa-lock text-4xl text-zinc-500 mb-2"></i>
                    <span class="text-xs text-cyan-500 font-bold">–ù–£–ñ–ï–ù 10 –£–†–û–í–ï–ù–¨</span>
                </div>
                <img src="https://images.unsplash.com/photo-1517976487492-5750f3195933?auto=format&fit=crop&q=80" class="w-full h-48 md:h-80 object-cover opacity-80 group-hover:opacity-100 transition">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent p-6 flex flex-col justify-end">
                    <h3 class="text-xl md:text-2xl font-bold text-cyan-400 mb-1">CRASH BEAST</h3>
                    <p class="text-zinc-400 text-[10px] md:text-sm">–£—Å–ø–µ–π –∑–∞–±—Ä–∞—Ç—å –¥–æ –∫—Ä–∞—à–∞</p>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-black py-8 border-t-2 border-zinc-800 mb-16 md:mb-0">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-zinc-600 text-[10px]">–ù–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º –∫–∞–∑–∏–Ω–æ. –î–µ–º–æ-–≤–µ—Ä—Å–∏—è.<br>¬© 2026 MeowFlopr.</p>
        </div>
    </footer>

    <div id="login-modal" class="fixed inset-0 bg-black/95 flex items-center justify-center z-[100] p-4">
        <div class="bg-zinc-900 border-2 border-pink-500 rounded-3xl p-6 md:p-10 w-full max-w-md shadow-[0_0_50px_rgba(236,72,153,0.3)]">
            <h2 class="text-2xl md:text-4xl text-center mb-6 text-pink-500 font-bold">–ö–¢–û –¢–´, –í–û–ò–ù?</h2>
            <input id="username-input" type="text" placeholder="–¢–≤–æ–π –Ω–∏–∫–Ω–µ–π–º" class="w-full bg-black border border-zinc-700 px-4 py-4 text-sm md:text-xl focus:outline-none focus:border-pink-500 rounded-xl mb-4 text-center">
            <button onclick="login()" class="w-full bg-pink-600 active:bg-pink-700 py-4 text-lg md:text-xl font-bold rounded-xl transition shadow-lg shadow-pink-600/20">–ü–û–ì–ù–ê–õ–ò üöÄ</button>
        </div>
    </div>

    <div id="slots-modal" class="fixed inset-0 bg-black/95 flex flex-col items-center justify-center hidden z-[60] p-2 md:p-8 overflow-y-auto">
        <div class="bg-zinc-950 border-2 border-yellow-400 rounded-3xl p-4 md:p-8 w-full max-w-2xl relative shadow-[0_0_50px_rgba(250,204,21,0.2)]">
            <button onclick="closeModal('slots-modal')" class="absolute top-4 right-4 text-zinc-500 hover:text-white text-2xl">‚úï</button>
            <h2 class="text-xl md:text-3xl text-yellow-400 text-center mb-6">–°–õ–û–¢–´</h2>
            
            <div class="flex justify-center gap-2 md:gap-4 mb-6 md:mb-8 bg-zinc-900 p-4 rounded-xl border border-zinc-800">
                <div id="reel1" class="reel w-20 h-20 md:w-32 md:h-32 flex items-center justify-center text-4xl md:text-6xl bg-black rounded-lg">üçí</div>
                <div id="reel2" class="reel w-20 h-20 md:w-32 md:h-32 flex items-center justify-center text-4xl md:text-6xl bg-black rounded-lg">üçí</div>
                <div id="reel3" class="reel w-20 h-20 md:w-32 md:h-32 flex items-center justify-center text-4xl md:text-6xl bg-black rounded-lg">üçí</div>
            </div>
            
            <div class="text-center mb-6">
                <div id="slots-result" class="h-8 text-sm md:text-xl font-bold text-emerald-400 mb-2"></div>
                <div class="text-xs md:text-base text-zinc-400">–°–¢–ê–í–ö–ê: <span id="current-bet-display" class="text-yellow-400">1000</span> ‚ÇΩ</div>
            </div>

            <div class="grid grid-cols-4 gap-2 mb-4">
                <button onclick="changeBet(100)" class="bg-zinc-800 py-2 rounded-lg text-[10px] md:text-sm hover:bg-zinc-700 border border-zinc-700">100</button>
                <button onclick="changeBet(1000)" class="bg-zinc-800 py-2 rounded-lg text-[10px] md:text-sm hover:bg-zinc-700 border border-zinc-700">1K</button>
                <button onclick="changeBet(5000)" class="bg-zinc-800 py-2 rounded-lg text-[10px] md:text-sm hover:bg-zinc-700 border border-zinc-700">5K</button>
                <button onclick="changeBet(10000)" class="bg-zinc-800 py-2 rounded-lg text-[10px] md:text-sm hover:bg-zinc-700 border border-zinc-700">10K</button>
            </div>

            <button onclick="spinSlots()" id="spin-btn" class="w-full bg-gradient-to-r from-yellow-500 to-amber-600 text-black py-4 md:py-6 text-xl md:text-2xl font-bold rounded-2xl active:scale-95 transition shadow-[0_0_20px_rgba(250,204,21,0.4)]">
                –ö–†–£–¢–ò–¢–¨!
            </button>
        </div>
    </div>

    <div id="epstein-modal" class="fixed inset-0 bg-black/95 flex flex-col items-center justify-center hidden z-[60] p-2 md:p-8 overflow-y-auto">
        <div class="bg-zinc-950 border-2 border-red-600 rounded-3xl p-4 md:p-8 w-full max-w-4xl relative flex flex-col md:flex-row gap-6">
            <button onclick="closeModal('epstein-modal')" class="absolute top-2 right-4 md:top-4 md:right-4 text-zinc-500 hover:text-white text-2xl z-10">‚úï</button>
            
            <div class="w-full md:w-1/3 flex flex-col order-2 md:order-1">
                <h2 class="text-xl md:text-3xl text-red-500 font-bold mb-4">MINES</h2>
                
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="setEpsteinBet(1000)" class="bet-opt bg-zinc-800 py-3 rounded-xl text-xs hover:border-red-500 border border-transparent">1000</button>
                    <button onclick="setEpsteinBet(5000)" class="bet-opt bg-zinc-800 py-3 rounded-xl text-xs hover:border-red-500 border border-transparent">5000</button>
                    <button onclick="setEpsteinBet(10000)" class="bet-opt bg-zinc-800 py-3 rounded-xl text-xs hover:border-red-500 border border-transparent">10K</button>
                    <button onclick="setEpsteinBet(50000)" class="bet-opt bg-zinc-800 py-3 rounded-xl text-xs hover:border-red-500 border border-transparent">50K</button>
                </div>

                <div class="mt-auto">
                    <div id="epstein-info" class="text-center mb-2 hidden">
                        <div class="text-[10px] text-zinc-400">–¢–ï–ö–£–©–ò–ô –í–´–ò–ì–†–´–®</div>
                        <div class="text-xl text-emerald-400 font-bold" id="epstein-current-win">0 ‚ÇΩ</div>
                    </div>
                    <button onclick="startEpstein()" id="epstein-action-btn" class="w-full bg-red-600 py-4 rounded-xl font-bold shadow-lg shadow-red-900/40 active:scale-95 transition">–ò–ì–†–ê–¢–¨</button>
                </div>
            </div>

            <div class="w-full md:w-2/3 order-1 md:order-2 bg-zinc-900/50 p-2 rounded-2xl">
                <div id="mines-grid" class="grid grid-cols-4 gap-2 aspect-square">
                    </div>
            </div>
        </div>
    </div>

    <div id="crash-modal" class="fixed inset-0 bg-black/95 flex flex-col items-center justify-center hidden z-[60] p-2 md:p-8 overflow-y-auto">
        <div class="bg-zinc-950 border-2 border-cyan-500 rounded-3xl p-4 md:p-8 w-full max-w-4xl relative flex flex-col gap-4">
            <button onclick="closeModal('crash-modal')" class="absolute top-2 right-4 text-zinc-500 hover:text-white text-2xl z-10">‚úï</button>
            
            <div class="flex justify-between items-end mb-2">
                <h2 class="text-xl md:text-3xl text-cyan-400 font-bold">CRASH</h2>
                <div class="text-xs text-zinc-500">History: <span id="crash-history" class="text-white space-x-1"></span></div>
            </div>

            <div class="relative w-full aspect-[16/9] bg-zinc-900 rounded-2xl border border-zinc-800 overflow-hidden">
                <canvas id="crash-canvas" class="w-full h-full block"></canvas>
                
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div id="crash-multiplier" class="text-5xl md:text-8xl font-black text-white drop-shadow-md">1.00x</div>
                </div>
                
                <div id="crash-status" class="absolute top-4 left-4 text-xs font-bold px-2 py-1 rounded bg-black/50 text-zinc-300">–û–ñ–ò–î–ê–ù–ò–ï</div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mt-2">
                <div class="w-full md:w-1/3 flex flex-col gap-2">
                    <label class="text-[10px] text-zinc-400 uppercase font-bold">–°—Ç–∞–≤–∫–∞</label>
                    <div class="flex gap-2">
                        <button onclick="adjCrashBet(-1000)" class="bg-zinc-800 px-3 rounded-lg">-</button>
                        <input id="crash-bet-input" type="number" value="1000" class="flex-1 bg-black border border-zinc-700 rounded-lg text-center py-2" readonly>
                        <button onclick="adjCrashBet(1000)" class="bg-zinc-800 px-3 rounded-lg">+</button>
                    </div>
                    <div class="flex gap-1 justify-between">
                        <button onclick="setCrashBetVal(1000)" class="text-[10px] bg-zinc-800/50 px-2 py-1 rounded text-zinc-400">1K</button>
                        <button onclick="setCrashBetVal(5000)" class="text-[10px] bg-zinc-800/50 px-2 py-1 rounded text-zinc-400">5K</button>
                        <button onclick="setCrashBetVal(10000)" class="text-[10px] bg-zinc-800/50 px-2 py-1 rounded text-zinc-400">10K</button>
                        <button onclick="setCrashBetVal(user.balance)" class="text-[10px] bg-zinc-800/50 px-2 py-1 rounded text-zinc-400">ALL</button>
                    </div>
                </div>
                
                <div class="w-full md:w-2/3">
                    <button id="crash-action-btn" onclick="startCrash()" class="w-full h-full bg-cyan-500 hover:bg-cyan-400 text-black font-black text-2xl md:text-3xl rounded-xl shadow-[0_0_20px_rgba(34,211,238,0.4)] transition active:scale-95 py-4">
                        –°–¢–ê–†–¢
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="leaderboard-modal" class="fixed inset-0 bg-black/95 flex items-center justify-center hidden z-[60] p-4">
        <div class="bg-zinc-900 border border-zinc-700 rounded-3xl p-6 w-full max-w-md">
            <h2 class="text-2xl text-center mb-6 neon-text">–¢–û–ü –ë–û–ì–ê–¢–ï–ï–í</h2>
            <div class="space-y-3" id="leaderboard-list">
                </div>
            <button onclick="closeModal('leaderboard-modal')" class="mt-6 w-full py-3 bg-zinc-800 rounded-xl text-sm">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <script>
        // --- GAME STATE ---
        let user = {
            username: "–ò–ì–†–û–ö",
            balance: 50000,
            level: 1,
            xp: 0
        };

        const LEVEL_THRESHOLDS = { 5: 500000, 10: 2000000 }; // XP needed

        // --- INIT ---
        window.onload = () => {
            if(localStorage.getItem('mf_user')) {
                user = JSON.parse(localStorage.getItem('mf_user'));
                document.getElementById('login-modal').classList.add('hidden');
                updateUI();
            } else {
                document.getElementById('login-modal').classList.remove('hidden');
            }
            updateLocks();
            
            // Adjust canvas resolution
            const canvas = document.getElementById('crash-canvas');
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        };

        window.onresize = () => {
            const canvas = document.getElementById('crash-canvas');
            if(canvas) {
                canvas.width = canvas.parentElement.offsetWidth;
                canvas.height = canvas.parentElement.offsetHeight;
            }
        }

        // --- CORE FUNCTIONS ---
        function login() {
            const name = document.getElementById('username-input').value.trim();
            if(name) user.username = name.toUpperCase();
            user.balance = 50000; 
            saveUser();
            document.getElementById('login-modal').classList.add('hidden');
            showToast(`–ü—Ä–∏–≤–µ—Ç, ${user.username}!`, 'success');
            updateUI();
        }

        function saveUser() {
            localStorage.setItem('mf_user', JSON.stringify(user));
            updateUI();
            updateLocks();
        }

        function updateUI() {
            document.getElementById('balance').textContent = formatMoney(user.balance);
            document.getElementById('user-level').textContent = user.level;
        }

        function updateLocks() {
            // Check Level 5 (Epstein)
            const epsteinLock = document.getElementById('lock-epstein');
            if(user.level < 5) epsteinLock.classList.remove('hidden');
            else epsteinLock.classList.add('hidden');

            // Check Level 10 (Crash)
            const crashLock = document.getElementById('lock-crash');
            if(user.level < 10) crashLock.classList.remove('hidden');
            else crashLock.classList.add('hidden');
        }

        function addXP(amount) {
            user.xp += amount;
            // Simple level up logic
            const nextLevel = Math.floor(user.xp / 50000) + 1;
            if(nextLevel > user.level) {
                user.level = nextLevel;
                showToast(`–ù–û–í–´–ô –£–†–û–í–ï–ù–¨: ${user.level}! üÜô`, 'neon');
                updateLocks();
            }
            saveUser();
        }

        function formatMoney(num) {
            if(num >= 1000000) return (num/1000000).toFixed(1) + 'M';
            if(num >= 1000) return (num/1000).toFixed(1) + 'k';
            return num;
        }

        // --- NOTIFICATION SYSTEM (TOASTS) ---
        function showToast(msg, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let colors = "border-pink-500 bg-zinc-900/90 text-white";
            if(type === 'success') colors = "border-emerald-500 bg-zinc-900/90 text-emerald-400";
            if(type === 'error') colors = "border-red-500 bg-zinc-900/90 text-red-400";
            if(type === 'neon') colors = "border-cyan-400 bg-black text-cyan-400 shadow-[0_0_10px_cyan]";

            toast.className = `pointer-events-auto w-full md:w-80 p-4 rounded-xl border-l-4 shadow-xl flex items-center justify-between gap-3 text-xs md:text-sm font-bold toast-enter ${colors}`;
            
            toast.innerHTML = `
                <span>${msg}</span>
                <button onclick="this.parentElement.remove()" class="opacity-50 hover:opacity-100">‚úï</button>
            `;

            container.appendChild(toast);

            // Trigger animation
            requestAnimationFrame(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-enter-active');
            });

            setTimeout(() => {
                toast.classList.remove('toast-enter-active');
                toast.classList.add('toast-exit-active');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- NAVIGATION ---
        function showSection(id) {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('games').classList.add('hidden');
            document.getElementById(id).classList.remove('hidden');
        }

        function openGame(game) {
            if(game === 'epstein' && user.level < 5) {
                showToast("–ù—É–∂–µ–Ω 5 —É—Ä–æ–≤–µ–Ω—å!", "error");
                return;
            }
            if(game === 'crash' && user.level < 10) {
                showToast("–ù—É–∂–µ–Ω 10 —É—Ä–æ–≤–µ–Ω—å!", "error");
                return;
            }
            
            document.getElementById(`${game}-modal`).classList.remove('hidden');
            
            if(game === 'epstein') initEpsteinGrid();
            if(game === 'crash') drawCrashGraph(0); // Clear canvas
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            if(id === 'crash-modal' && crashRunning) {
                // Background crash logic handled in loop
            }
        }

        function showBonus() {
            const now = Date.now();
            const last = localStorage.getItem('mf_bonus_time') || 0;
            if(now - last < 60000) { // 1 min cooldown
                showToast("–ü–æ–¥–æ–∂–¥–∏ –º–∏–Ω—É—Ç—É!", "error");
                return;
            }
            user.balance += 5000;
            localStorage.setItem('mf_bonus_time', now);
            saveUser();
            showToast("+5000 ‚ÇΩ –ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω!", "success");
        }

        // ==================== SLOTS LOGIC ====================
        let currentBet = 1000;
        const slotSymbols = ["üçí", "üçã", "üçá", "üíé", "7Ô∏è‚É£"];
        
        function changeBet(amount) {
            currentBet = amount;
            document.getElementById('current-bet-display').textContent = amount;
        }

        function spinSlots() {
            if(user.balance < currentBet) return showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥!", "error");
            
            user.balance -= currentBet;
            saveUser();
            
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            btn.classList.add('opacity-50');
            document.getElementById('slots-result').innerHTML = "";

            let spins = 0;
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
            const finalRes = [];

            const interval = setInterval(() => {
                reels.forEach(r => r.innerText = slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);
                spins++;
                if(spins > 20) {
                    clearInterval(interval);
                    // Determine result
                    reels.forEach(r => {
                        const sym = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                        r.innerText = sym;
                        finalRes.push(sym);
                    });
                    
                    checkSlotsWin(finalRes);
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                }
            }, 50);
        }

        function checkSlotsWin(res) {
            let win = 0;
            if(res[0] === res[1] && res[1] === res[2]) {
                win = currentBet * 10;
                if(res[0] === "üíé") win = currentBet * 50;
                if(res[0] === "7Ô∏è‚É£") win = currentBet * 100;
                document.getElementById('slots-result').innerHTML = "–î–ñ–ï–ö–ü–û–¢!";
                showToast(`–î–ñ–ï–ö–ü–û–¢! +${win} ‚ÇΩ`, "neon");
            } else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) {
                win = currentBet * 1.5;
                document.getElementById('slots-result').innerHTML = "–ï–°–¢–¨ –ö–û–ù–¢–ê–ö–¢";
            } else {
                document.getElementById('slots-result').innerHTML = "–ú–ò–ú–û...";
            }

            if(win > 0) {
                user.balance += win;
                addXP(win / 10);
                showToast(`–í—ã–∏–≥—Ä—ã—à: ${win} ‚ÇΩ`, "success");
                saveUser();
            }
        }

        // ==================== EPSTEIN (MINES) LOGIC ====================
        let epsteinBet = 1000;
        let epsteinGameActive = false;
        let epsteinMines = [];
        let epsteinCurrentMultiplier = 1;

        function setEpsteinBet(val) {
            if(!epsteinGameActive) epsteinBet = val;
            else showToast("–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç", "error");
        }

        function initEpsteinGrid() {
            const grid = document.getElementById('mines-grid');
            grid.innerHTML = "";
            epsteinGameActive = false;
            document.getElementById('epstein-action-btn').textContent = "–ò–ì–†–ê–¢–¨";
            document.getElementById('epstein-action-btn').classList.remove('bg-emerald-500');
            document.getElementById('epstein-action-btn').classList.add('bg-red-600');
            document.getElementById('epstein-info').classList.add('hidden');
            
            // Generate 16 cells
            for(let i=0; i<16; i++) {
                const cell = document.createElement('div');
                cell.className = "bg-zinc-800 rounded-lg flex items-center justify-center text-2xl font-bold cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent";
                cell.dataset.idx = i;
                cell.onclick = () => clickMine(i, cell);
                grid.appendChild(cell);
            }
        }

        function startEpstein() {
            if(epsteinGameActive) {
                // Cashout logic
                cashoutEpstein();
                return;
            }

            if(user.balance < epsteinBet) return showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥!", "error");
            
            user.balance -= epsteinBet;
            saveUser();
            
            epsteinGameActive = true;
            epsteinCurrentMultiplier = 1;
            epsteinMines = Array(16).fill(0); // 0 = safe, 1 = mine
            
            // Place 3 mines randomly
            let minesPlaced = 0;
            while(minesPlaced < 3) {
                let idx = Math.floor(Math.random() * 16);
                if(epsteinMines[idx] === 0) {
                    epsteinMines[idx] = 1;
                    minesPlaced++;
                }
            }
            
            // Reset grid visuals
            document.querySelectorAll('#mines-grid > div').forEach(d => {
                d.className = "bg-zinc-800 rounded-lg flex items-center justify-center text-2xl font-bold cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent";
                d.innerHTML = "";
            });

            document.getElementById('epstein-action-btn').textContent = "–ó–ê–ë–†–ê–¢–¨ –î–ï–ù–¨–ì–ò";
            document.getElementById('epstein-action-btn').classList.remove('bg-red-600');
            document.getElementById('epstein-action-btn').classList.add('bg-emerald-500');
            document.getElementById('epstein-info').classList.remove('hidden');
            document.getElementById('epstein-current-win').textContent = epsteinBet + " ‚ÇΩ";
        }

        function clickMine(idx, cell) {
            if(!epsteinGameActive || cell.classList.contains('bg-zinc-900')) return;

            if(epsteinMines[idx] === 1) {
                // BOOM
                cell.innerHTML = "üí£";
                cell.classList.add("bg-red-900", "border-red-500");
                gameOverEpstein(false);
            } else {
                // SAFE
                cell.innerHTML = "üíé";
                cell.classList.remove("bg-zinc-800");
                cell.classList.add("bg-zinc-900", "border-emerald-500", "text-emerald-400");
                
                epsteinCurrentMultiplier *= 1.4;
                const currentWin = Math.floor(epsteinBet * epsteinCurrentMultiplier);
                document.getElementById('epstein-current-win').textContent = currentWin + " ‚ÇΩ";
            }
        }

        function cashoutEpstein() {
            const win = Math.floor(epsteinBet * epsteinCurrentMultiplier);
            user.balance += win;
            addXP(win / 100);
            saveUser();
            showToast(`+${win} ‚ÇΩ`, "success");
            gameOverEpstein(true);
        }

        function gameOverEpstein(win) {
            epsteinGameActive = false;
            // Reveal all
            const cells = document.getElementById('mines-grid').children;
            for(let i=0; i<16; i++) {
                if(epsteinMines[i] === 1) cells[i].innerHTML = "üí£";
                else cells[i].classList.add("opacity-50");
            }
            
            setTimeout(() => {
                document.getElementById('epstein-action-btn').textContent = "–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê";
                document.getElementById('epstein-action-btn').classList.remove('bg-emerald-500');
                document.getElementById('epstein-action-btn').classList.add('bg-red-600');
            }, 500);
        }

        // ==================== NEW CRASH LOGIC (THE REWRITE) ====================
        let crashBet = 1000;
        let crashRunning = false;
        let crashMultiplier = 1.00;
        let crashPoint = 0;
        let crashLoop = null;
        let crashStartTime = 0;
        
        const canvas = document.getElementById('crash-canvas');
        const ctx = canvas.getContext('2d');

        function setCrashBetVal(val) {
            crashBet = val;
            document.getElementById('crash-bet-input').value = val;
        }

        function adjCrashBet(delta) {
            let val = parseInt(document.getElementById('crash-bet-input').value) || 0;
            val += delta;
            if(val < 100) val = 100;
            crashBet = val;
            document.getElementById('crash-bet-input').value = val;
        }

        function startCrash() {
            if(crashRunning) {
                // CASHOUT
                doCrashCashout();
                return;
            }

            if(user.balance < crashBet) return showToast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!", "error");
            user.balance -= crashBet;
            saveUser();

            // Reset Game State
            crashRunning = true;
            crashMultiplier = 1.00;
            crashStartTime = Date.now();
            
            // Logic: Random crash point weighted to low numbers
            // 1% chance of instant crash (1.00x)
            // 50% chance < 2.00x
            const r = Math.random();
            if (r < 0.03) crashPoint = 1.00; // House edge
            else crashPoint = 0.99 / (1 - r);
            if(crashPoint > 100) crashPoint = 100;

            // UI Updates
            const btn = document.getElementById('crash-action-btn');
            btn.textContent = "–ó–ê–ë–†–ê–¢–¨";
            btn.className = "w-full h-full bg-emerald-500 hover:bg-emerald-400 text-black font-black text-2xl md:text-3xl rounded-xl transition active:scale-95 py-4";
            document.getElementById('crash-status').textContent = "–õ–ï–¢–ò–ú!";
            document.getElementById('crash-status').className = "absolute top-4 left-4 text-xs font-bold px-2 py-1 rounded bg-emerald-500 text-black animate-pulse";
            document.getElementById('crash-multiplier').classList.remove('text-red-500');
            document.getElementById('crash-multiplier').classList.add('text-white');

            crashLoop = requestAnimationFrame(crashTick);
        }

        function crashTick() {
            if(!crashRunning) return;

            const now = Date.now();
            const elapsed = (now - crashStartTime) / 1000; // seconds
            
            // Exponential growth formula
            // Grows slowly at first, then fast
            crashMultiplier = 1.00 + (Math.pow(elapsed, 2.5) * 0.1) + (elapsed * 0.05);

            // Draw Graph
            drawCrashGraph(elapsed);
            document.getElementById('crash-multiplier').textContent = crashMultiplier.toFixed(2) + "x";

            // CHECK CRASH
            if(crashMultiplier >= crashPoint) {
                crashBoom();
            } else {
                crashLoop = requestAnimationFrame(crashTick);
            }
        }

        function doCrashCashout() {
            crashRunning = false;
            cancelAnimationFrame(crashLoop);
            
            const win = Math.floor(crashBet * crashMultiplier);
            user.balance += win;
            addXP(win/100);
            saveUser();
            
            showToast(`–£—Å–ø–µ—Ö! +${win} ‚ÇΩ`, "success");
            
            const btn = document.getElementById('crash-action-btn');
            btn.textContent = "–°–¢–ê–†–¢";
            btn.className = "w-full h-full bg-cyan-500 hover:bg-cyan-400 text-black font-black text-2xl md:text-3xl rounded-xl transition active:scale-95 py-4";
            
            document.getElementById('crash-status').textContent = "–í–´–ò–ì–†–´–®";
            document.getElementById('crash-status').className = "absolute top-4 left-4 text-xs font-bold px-2 py-1 rounded bg-emerald-500 text-black";
            document.getElementById('crash-multiplier').classList.add('text-emerald-400');
            
            addToHistory(crashMultiplier.toFixed(2), true);
        }

        function crashBoom() {
            crashRunning = false;
            cancelAnimationFrame(crashLoop);
            
            document.getElementById('crash-multiplier').textContent = crashPoint.toFixed(2) + "x";
            document.getElementById('crash-multiplier').classList.remove('text-white');
            document.getElementById('crash-multiplier').classList.add('text-red-500');
            
            const btn = document.getElementById('crash-action-btn');
            btn.textContent = "–°–¢–ê–†–¢";
            btn.className = "w-full h-full bg-cyan-500 hover:bg-cyan-400 text-black font-black text-2xl md:text-3xl rounded-xl transition active:scale-95 py-4";

            document.getElementById('crash-status').textContent = "CRASHED";
            document.getElementById('crash-status').className = "absolute top-4 left-4 text-xs font-bold px-2 py-1 rounded bg-red-600 text-white";
            
            showToast("–†–∞–∫–µ—Ç–∞ –≤–∑–æ—Ä–≤–∞–ª–∞—Å—å!", "error");
            addToHistory(crashPoint.toFixed(2), false);
        }

        function drawCrashGraph(time) {
            // Resize if needed
            if(canvas.width !== canvas.parentElement.offsetWidth) {
                canvas.width = canvas.parentElement.offsetWidth;
                canvas.height = canvas.parentElement.offsetHeight;
            }

            const w = canvas.width;
            const h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            // Grid
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, h-20); ctx.lineTo(w, h-20);
            ctx.moveTo(20, 0); ctx.lineTo(20, h);
            ctx.stroke();

            if(time === 0) return;

            // Rocket Path
            ctx.strokeStyle = "#22d3ee";
            ctx.lineWidth = 4;
            ctx.lineCap = "round";
            ctx.shadowColor = "#22d3ee";
            ctx.shadowBlur = 10;
            
            ctx.beginPath();
            ctx.moveTo(20, h-20);
            
            // Simple visual representation of curve
            // We map time (x) and multiplier (y) to canvas coords
            // Visual Scaling: 
            const x = 20 + (time * 30); // moves 30px per sec
            const y = (h-20) - ((crashMultiplier - 1) * 50); // moves up 50px per 1x
            
            // Quadratic curve for smoothness
            ctx.quadraticCurveTo(20 + x/2, h-20, x, y);
            ctx.stroke();

            // Rocket Head
            ctx.shadowBlur = 0;
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.fill();
        }

        function addToHistory(mult, win) {
            const hist = document.getElementById('crash-history');
            const span = document.createElement('span');
            span.textContent = mult + "x";
            span.className = win ? "text-emerald-400 text-[10px]" : "text-red-500 text-[10px]";
            if(hist.children.length > 5) hist.firstChild.remove();
            hist.appendChild(span);
        }

        function showLeaderboard() {
            document.getElementById('leaderboard-modal').classList.remove('hidden');
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = `
                <div class="flex justify-between border-b border-zinc-700 pb-2">
                    <span>1. MeowFlopr</span>
                    <span class="text-yellow-400">‚àû ‚ÇΩ</span>
                </div>
                <div class="flex justify-between border-b border-zinc-700 pb-2">
                    <span>2. ${user.username} (–í—ã)</span>
                    <span class="text-emerald-400">${formatMoney(user.balance)} ‚ÇΩ</span>
                </div>
                <div class="flex justify-between border-b border-zinc-700 pb-2 opacity-50">
                    <span>3. HamsterKombat</span>
                    <span class="text-zinc-400">0 ‚ÇΩ</span>
                </div>
            `;
        }
        
        function showProfile() {
            const newName = prompt("–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫:", user.username);
            if(newName) {
                user.username = newName.toUpperCase();
                saveUser();
                showToast("–ù–∏–∫ –∏–∑–º–µ–Ω–µ–Ω!");
            }
        }
    </script>
</body>
</html>
