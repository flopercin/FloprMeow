<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MeowFlopr Casino</title>
    <link rel="icon" type="image/jpeg" href="main.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            font-family: 'Press Start 2P', system-ui;
            user-select: none;
            background-color: #09090b;
            overscroll-behavior: none; /* –ë–ª–æ–∫–∏—Ä—É–µ—Ç "—Ä–µ–∑–∏–Ω–∫—É" –Ω–∞ iOS */
        }
        
        .neon-text {
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #ec4899;
            border-radius: 4px;
        }

        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-hover:active {
            transform: scale(0.98);
        }
        @media (hover: hover) {
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px -10px #ec4899;
            }
        }

        .card-locked {
            filter: grayscale(100%);
            pointer-events: none;
        }

        .reel {
            height: 120px;
            overflow: hidden;
            border: 2px solid #ffd700;
            background: #111;
            position: relative;
        }
        @media (min-width: 768px) {
            .reel { height: 180px; }
        }

        /* –ö–∞–Ω–≤–∞—Å –¥–ª—è —Ä–∞–∫–µ—Ç—ã */
        #crash-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .level-bar {
            transition: width 0.3s ease-out;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–µ–Ω–µ–≥ */
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .float-money {
            position: absolute;
            animation: floatUp 1s forwards;
            color: #34d399;
            font-weight: bold;
            pointer-events: none;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-zinc-950 text-white min-h-screen flex flex-col">

    <header class="bg-black/90 backdrop-blur-md border-b-2 border-pink-500 sticky top-0 z-40 shadow-lg shadow-pink-500/10">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="main.jpg" class="w-10 h-10 rounded-full border-2 border-pink-500 object-cover shadow-[0_0_10px_#ec4899]">
                    <div class="hidden sm:block">
                        <h1 class="text-lg font-bold neon-text tracking-widest text-pink-500">MEOWFLOPR</h1>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div class="flex flex-col items-end mr-1">
                        <div class="text-[10px] text-pink-300 mb-1">LVL <span id="level-display">1</span></div>
                        <div class="w-20 sm:w-32 h-2 bg-zinc-800 rounded-full overflow-hidden border border-zinc-700">
                            <div id="xp-bar" class="h-full bg-gradient-to-r from-pink-600 to-purple-600 level-bar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="bg-zinc-900 pl-3 pr-4 py-1.5 rounded-full border border-emerald-500/50 flex items-center gap-2 shadow-[0_0_15px_-5px_#10b981]">
                        <span class="text-emerald-400 text-xs">‚ÇΩ</span>
                        <span id="balance" class="font-bold text-sm sm:text-base">10000</span>
                    </div>
                    
                    <div onclick="showProfile()" class="w-10 h-10 bg-zinc-800 rounded-full flex items-center justify-center cursor-pointer border border-zinc-700 hover:border-pink-500 active:scale-95 transition">
                        üë§
                    </div>
                </div>
            </div>
        </div>
    </header>

    <section id="home" class="flex-1 flex flex-col items-center justify-center p-4 relative overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,#4c1d9520_0%,#000_100%)] z-0"></div>
        
        <div class="z-10 text-center max-w-lg w-full mt-8">
            <h1 class="text-3xl sm:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-400 mb-2 drop-shadow-lg">
                MEOWFLOPR
            </h1>
            <p class="text-zinc-500 text-[10px] sm:text-xs mb-8 tracking-widest">CASINO & ENTERTAINMENT</p>
            
            <button onclick="showGames()" class="w-full sm:w-auto bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 py-4 px-12 text-lg font-bold rounded-2xl shadow-[0_0_20px_rgba(236,72,153,0.4)] active:scale-95 transition mb-12">
                –ò–ì–†–ê–¢–¨
            </button>

            <div class="bg-zinc-900/80 backdrop-blur border border-yellow-500/30 rounded-2xl p-5 w-full shadow-lg">
                <h3 class="text-yellow-400 text-sm mb-4 flex items-center justify-center gap-2">
                    <i class="fas fa-crown"></i> –¢–û–ü –ë–û–ì–ê–¢–ï–ô–®–ò–•
                </h3>
                <div class="space-y-3 text-xs sm:text-sm">
                    <div class="flex justify-between items-center border-b border-zinc-800 pb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-yellow-500 font-bold">1.</span>
                            <span class="font-bold">MeowFlopr</span>
                            <span class="text-[8px] bg-yellow-500/20 text-yellow-500 px-1.5 py-0.5 rounded border border-yellow-500/50">DEV</span>
                        </div>
                        <div class="text-emerald-400 font-mono">1.48B ‚ÇΩ</div>
                    </div>
                    <div class="flex justify-between items-center text-zinc-400">
                        <div class="flex items-center gap-2">
                            <span>2.</span>
                            <span>Barbariki</span>
                        </div>
                        <div class="font-mono">500K ‚ÇΩ</div>
                    </div>
                     <div class="flex justify-between items-center text-zinc-500">
                        <div class="flex items-center gap-2">
                            <span>3.</span>
                            <span>Udalo</span>
                        </div>
                        <div class="font-mono">12K ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="games" class="hidden max-w-7xl mx-auto px-4 py-8 w-full">
        <button onclick="showSection('home')" class="mb-6 text-xs text-zinc-500 hover:text-white flex items-center gap-2 py-2">
            <i class="fas fa-arrow-left"></i> –ù–ê–ó–ê–î
        </button>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
            <div onclick="openSlotsModal()" class="card-hover bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 cursor-pointer group">
                <div class="h-40 overflow-hidden relative">
                    <img src="https://cdn.nur.kz/images/1200x675/36135d7df8b99f1afe63116c264a570c.jpeg?version=1" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                    <div class="absolute bottom-0 left-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-1">LVL 1+</div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-bold text-white mb-1">–°–ª–æ—Ç—ã –ú–µ–ª—Å—Ç—Ä–æ—è</h3>
                    <p class="text-zinc-500 text-[10px]">–ö–ª–∞—Å—Å–∏–∫–∞. –ö—Ä—É—Ç–∏ –∏ –ª—É—Ç–∞–π.</p>
                </div>
            </div>
            
            <div id="game-epstein" onclick="openEpsteinModal()" class="card-hover bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 cursor-pointer relative group">
                <div class="lock-overlay absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-10 backdrop-blur-sm hidden">
                    <i class="fas fa-lock text-2xl text-zinc-600 mb-2"></i>
                    <span class="text-red-500 font-bold text-xs">–ù–£–ñ–ï–ù 5 LVL</span>
                </div>
                <div class="h-40 overflow-hidden relative">
                    <img src="https://nypost.com/wp-content/uploads/sites/2/2019/08/jeffrey-epstein-2-3.jpg?quality=75&strip=all" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition duration-500">
                    <div class="absolute bottom-0 left-0 bg-red-600 text-white text-[10px] font-bold px-2 py-1">LVL 5+</div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-bold text-red-400 mb-1">–û—Å—Ç—Ä–æ–≤ –≠–ø—à—Ç–µ–π–Ω–∞</h3>
                    <p class="text-zinc-500 text-[10px]">–°–∞–ø–µ—Ä –Ω–∞ –º–∏–Ω–Ω–æ–º –ø–æ–ª–µ.</p>
                </div>
            </div>

            <div id="game-mrbeast" onclick="openBeastModal()" class="card-hover bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 cursor-pointer relative group">
                <div class="lock-overlay absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-10 backdrop-blur-sm hidden">
                    <i class="fas fa-lock text-2xl text-zinc-600 mb-2"></i>
                    <span class="text-blue-500 font-bold text-xs">–ù–£–ñ–ï–ù 10 LVL</span>
                </div>
                <div class="h-40 overflow-hidden relative">
                    <img src="mrbeast.jpg" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition duration-500">
                    <div class="absolute bottom-0 left-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-1">LVL 10+</div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-bold text-blue-400 mb-1">Beast Crash</h3>
                    <p class="text-zinc-500 text-[10px]">–£—Å–ø–µ–π –∑–∞–±—Ä–∞—Ç—å –¥–æ –≤–∑—Ä—ã–≤–∞!</p>
                </div>
            </div>
        </div>
    </section>

    <div id="login-modal" class="fixed inset-0 bg-black/95 flex items-center justify-center hidden z-[60] px-4">
        <div class="bg-zinc-900 border border-pink-500/50 rounded-3xl p-6 w-full max-w-xs shadow-[0_0_50px_rgba(236,72,153,0.2)]">
            <h2 class="text-xl text-center mb-6 font-bold text-white">–í–í–ï–î–ò –ù–ò–ö</h2>
            <input id="username-input" type="text" placeholder="User123" class="w-full bg-black border border-zinc-700 px-4 py-3 text-sm focus:outline-none focus:border-pink-500 rounded-xl mb-4 text-white">
            <button onclick="login()" class="w-full bg-pink-600 py-3 font-bold rounded-xl text-sm hover:bg-pink-500 transition">–°–¢–ê–†–¢</button>
        </div>
    </div>

    <div id="slots-modal" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-zinc-950 border-2 border-yellow-500 rounded-2xl w-full max-w-lg flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center p-4 border-b border-zinc-800">
                <h2 class="text-sm md:text-lg text-yellow-500 font-bold">–°–õ–û–¢–´ –ú–ï–õ–°–¢–†–û–Ø</h2>
                <button onclick="closeModal('slots-modal')" class="w-8 h-8 flex items-center justify-center rounded-full bg-zinc-800 hover:bg-zinc-700">‚úï</button>
            </div>
            
            <div class="overflow-y-auto custom-scroll p-4 flex-1">
                <div class="flex justify-center gap-2 mb-6">
                    <div id="reel1" class="reel flex-1 rounded-lg"></div>
                    <div id="reel2" class="reel flex-1 rounded-lg"></div>
                    <div id="reel3" class="reel flex-1 rounded-lg"></div>
                </div>
                
                <div class="bg-zinc-900 rounded-xl p-3 mb-4">
                    <div class="grid grid-cols-4 gap-2 mb-2 standard-bets">
                        <button onclick="setBet(100)" class="bet-btn bg-zinc-800 py-2 rounded-lg text-[10px] hover:bg-zinc-700 border border-zinc-700">100</button>
                        <button onclick="setBet(500)" class="bet-btn bg-zinc-800 py-2 rounded-lg text-[10px] hover:bg-zinc-700 border border-zinc-700">500</button>
                        <button onclick="setBet(1000)" class="bet-btn bg-zinc-800 py-2 rounded-lg text-[10px] hover:bg-zinc-700 border border-zinc-700">1K</button>
                        <button onclick="setBet(5000)" class="bet-btn bg-zinc-800 py-2 rounded-lg text-[10px] hover:bg-zinc-700 border border-zinc-700">5K</button>
                    </div>
                    <div class="custom-bet-div hidden">
                        <input type="number" placeholder="–°—Ç–∞–≤–∫–∞..." class="w-full bg-black border border-zinc-700 p-2 rounded-lg text-center text-sm" onchange="setCustomBet(this.value)">
                    </div>
                    <div class="text-center text-xs text-zinc-400 mt-2">–°—Ç–∞–≤–∫–∞: <span id="current-bet-display" class="text-white font-bold">100</span> ‚ÇΩ</div>
                </div>

                <div id="slots-result" class="h-8 text-center text-sm font-bold mb-2"></div>
                
                <button onclick="spinSlots()" id="spin-button" class="w-full bg-gradient-to-b from-yellow-500 to-orange-600 text-black font-bold py-4 rounded-xl shadow-lg active:scale-95 transition text-lg">
                    –ö–†–£–¢–ò–¢–¨
                </button>
            </div>
        </div>
    </div>

    <div id="epstein-modal" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-zinc-950 border-2 border-red-600 rounded-2xl w-full max-w-lg flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center p-4 border-b border-zinc-800">
                <h2 class="text-sm md:text-lg text-red-500 font-bold">–û–°–¢–†–û–í –≠–ü–®–¢–ï–ô–ù–ê</h2>
                <button onclick="closeModal('epstein-modal')" class="w-8 h-8 flex items-center justify-center rounded-full bg-zinc-800 hover:bg-zinc-700">‚úï</button>
            </div>
            
            <div class="overflow-y-auto custom-scroll p-4 flex-1">
                <div class="grid grid-cols-4 gap-2 aspect-square mb-6" id="epstein-grid">
                    </div>

                <div class="bg-zinc-900 rounded-xl p-3">
                    <div id="epstein-controls">
                        <div class="grid grid-cols-4 gap-2 mb-3 standard-bets">
                            <button onclick="setGameBet('epstein', 1000)" class="bet-btn-epstein bg-zinc-800 py-2 rounded-lg text-[10px]">1K</button>
                            <button onclick="setGameBet('epstein', 5000)" class="bet-btn-epstein bg-zinc-800 py-2 rounded-lg text-[10px]">5K</button>
                            <button onclick="setGameBet('epstein', 10000)" class="bet-btn-epstein bg-zinc-800 py-2 rounded-lg text-[10px]">10K</button>
                            <button onclick="setGameBet('epstein', 25000)" class="bet-btn-epstein bg-zinc-800 py-2 rounded-lg text-[10px]">25K</button>
                        </div>
                        <div class="custom-bet-div hidden mb-3">
                            <input type="number" class="w-full bg-black border border-zinc-700 p-2 rounded-lg text-center text-sm" placeholder="–°—É–º–º–∞" onchange="setCustomBetGeneric('epstein', this.value)">
                        </div>
                        <button onclick="startEpstein()" class="w-full bg-red-600 py-3 rounded-xl font-bold">–°–¢–ê–†–¢</button>
                    </div>

                    <div id="epstein-cashout-ui" class="hidden">
                        <div class="text-center mb-2">
                            <div class="text-xs text-zinc-400">–í–´–ò–ì–†–´–®</div>
                            <div class="text-xl text-emerald-400 font-bold">+<span id="epstein-win-amount">0</span></div>
                        </div>
                        <button onclick="cashoutEpstein()" class="w-full bg-emerald-600 py-3 rounded-xl font-bold animate-pulse">–ó–ê–ë–†–ê–¢–¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="beast-modal" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-zinc-950 border-2 border-blue-600 rounded-2xl w-full max-w-lg flex flex-col max-h-[95vh]">
            <div class="flex justify-between items-center p-4 border-b border-zinc-800">
                <h2 class="text-sm md:text-lg text-blue-500 font-bold">BEAST CRASH</h2>
                <button onclick="closeModal('beast-modal')" class="w-8 h-8 flex items-center justify-center rounded-full bg-zinc-800 hover:bg-zinc-700">‚úï</button>
            </div>
            
            <div class="p-2 flex-1 flex flex-col">
                <div class="relative bg-zinc-900 rounded-xl border border-zinc-800 w-full h-64 mb-4 overflow-hidden">
                    <canvas id="crash-canvas"></canvas>
                    
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <span id="crash-multiplier" class="text-4xl font-bold text-white drop-shadow-md">1.00x</span>
                    </div>

                    <div id="crash-overlay" class="absolute inset-0 bg-black/80 flex items-center justify-center hidden">
                        <div class="text-center">
                            <div class="text-red-500 text-3xl font-black mb-1">CRASHED</div>
                            <div class="text-zinc-400 text-sm">@ <span id="crash-final-val">1.00</span>x</div>
                        </div>
                    </div>
                </div>

                <div class="bg-zinc-900 rounded-xl p-3 mt-auto">
                    <div class="flex gap-3 mb-3">
                        <div class="flex-1">
                            <div class="text-[10px] text-zinc-500 mb-1">–°–¢–ê–í–ö–ê</div>
                            <div class="flex gap-1 standard-bets">
                                <button onclick="setGameBet('beast', 1000)" class="flex-1 bg-zinc-800 py-2 rounded text-[10px] hover:bg-blue-900 transition bet-btn-beast">1K</button>
                                <button onclick="setGameBet('beast', 5000)" class="flex-1 bg-zinc-800 py-2 rounded text-[10px] hover:bg-blue-900 transition bet-btn-beast">5K</button>
                            </div>
                            <div class="custom-bet-div hidden">
                                <input type="number" class="w-full bg-black border border-zinc-700 p-2 rounded text-center text-sm" onchange="setCustomBetGeneric('beast', this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <button id="beast-action-btn" onclick="startBeast()" class="w-full h-12 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-lg shadow-[0_0_15px_rgba(37,99,235,0.4)] transition">
                        –°–¢–ê–†–¢
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –î–ê–ù–ù–´–ï ===
        let user = {
            username: "–ò–ì–†–û–ö",
            balance: 10000,
            level: 1,
            xp: 0,
            maxXp: 200 // –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ (–±—ã–ª–æ 1000)
        };

        const symbols = [
            { name: "banana", url: "https://avatars.mds.yandex.net/get-mpic/5234083/img_id3506543352633991634.png/orig" },
            { name: "plum", url: "https://main-cdn.sbermegamarket.ru/big1/hlr-system/-90/257/429/371/118/48/100032397594b0.jpg" },
            { name: "grape", url: "https://avatars.mds.yandex.net/get-mpic/5145248/img_id4537599123360367823.png/orig" }
        ];

        let currentBets = { slots: 100, epstein: 1000, beast: 1000 };
        let epsteinState = { active: false, winnings: 0, bet: 0 };
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∫–µ—Ç—ã
        let beastState = { active: false, multiplier: 1.00, bet: 0, startTime: 0, animationId: null, crashed: false };
        const rocketImg = new Image(); rocketImg.src = 'raketmrbeast.jpg';
        const canvas = document.getElementById('crash-canvas');
        const ctx = canvas.getContext('2d');
        let graphPoints = [];

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        window.onload = function() {
            loadUser();
            if (!localStorage.getItem("mf_user_v3")) {
                document.getElementById("login-modal").classList.remove("hidden");
            }
            showSection('home');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–≤–∞—Å–∞
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        };

        function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
            if(!beastState.active) drawBeastIdle();
        }

        // === –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø –ò –û–ü–´–¢–ê ===
        function loadUser() {
            const saved = localStorage.getItem("mf_user_v3");
            if (saved) user = JSON.parse(saved);
            updateUI();
        }

        function saveUser() {
            localStorage.setItem("mf_user_v3", JSON.stringify(user));
            updateUI();
        }

        function updateUI() {
            document.getElementById("balance").textContent = Math.floor(user.balance).toLocaleString("ru-RU");
            document.getElementById("username-display").textContent = user.username; // –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById("level-display").textContent = user.level;
            
            const xpPercent = Math.min((user.xp / user.maxXp) * 100, 100);
            document.getElementById("xp-bar").style.width = `${xpPercent}%`;
            
            checkLocks();
            checkCustomBets();
        }

        function addXp(betAmount) {
            // –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–∫–∞—á–∫–∞:
            // –ú–∏–Ω–∏–º—É–º 30 –æ–ø—ã—Ç–∞, –ø–ª—é—Å 5% –æ—Ç —Å—Ç–∞–≤–∫–∏.
            const xpGain = Math.floor(30 + (betAmount * 0.05));
            
            user.xp += xpGain;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è (while –Ω–∞ —Å–ª—É—á–∞–π –¥–≤–æ–π–Ω–æ–≥–æ –∞–ø–∞)
            while (user.xp >= user.maxXp) {
                user.level++;
                user.xp -= user.maxXp;
                user.maxXp = Math.floor(user.maxXp * 1.3); // –†–∞—Å—Ç–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–±—ã–ª–æ 1.5)
                showFloatingText(`–£–†–û–í–ï–ù–¨ ${user.level}!`, window.innerWidth/2, window.innerHeight/2, '#ff00ff');
            }
            saveUser();
        }

        function showFloatingText(text, x, y, color) {
            const el = document.createElement("div");
            el.className = "float-money fixed text-2xl font-bold z-[100]";
            el.style.left = x + "px";
            el.style.top = y + "px";
            el.style.color = color;
            el.textContent = text;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function checkLocks() {
            const toggleLock = (id, lvl) => {
                const el = document.getElementById(id);
                const lock = el.querySelector(".lock-overlay");
                if (user.level >= lvl) {
                    lock.classList.add("hidden");
                    el.classList.remove("card-locked");
                } else {
                    lock.classList.remove("hidden");
                    el.classList.add("card-locked");
                }
            };
            toggleLock("game-epstein", 5);
            toggleLock("game-mrbeast", 10);
        }

        function checkCustomBets() {
            if (user.level >= 15) {
                document.querySelectorAll(".standard-bets").forEach(el => el.classList.add("hidden"));
                document.querySelectorAll(".custom-bet-div").forEach(el => el.classList.remove("hidden"));
            }
        }

        // === –ù–ê–í–ò–ì–ê–¶–ò–Ø ===
        function login() {
            const val = document.getElementById("username-input").value.trim();
            if(val) user.username = val;
            document.getElementById("login-modal").classList.add("hidden");
            saveUser();
        }
        
        function showSection(id) {
            document.getElementById("home").classList.add("hidden");
            document.getElementById("games").classList.add("hidden");
            document.getElementById(id).classList.remove("hidden");
        }
        function showGames() { showSection("games"); }
        function showProfile() {
            const n = prompt("–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫:", user.username);
            if(n) { user.username = n; saveUser(); }
        }
        function closeModal(id) {
            document.getElementById(id).classList.add("hidden");
            if(id === 'beast-modal' && beastState.active) beastCashout(); // –ê–≤—Ç–æ–≤—ã–≤–æ–¥ –µ—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∏
        }

        // === –°–¢–ê–í–ö–ò ===
        function setBet(amount) {
            currentBets.slots = amount;
            document.getElementById("current-bet-display").textContent = amount;
        }
        function setGameBet(game, amount) {
            currentBets[game] = amount;
            if(game === 'beast') {
                document.querySelectorAll('.bet-btn-beast').forEach(b => b.classList.remove('bg-blue-600', 'text-white'));
                event.target.classList.add('bg-blue-600', 'text-white');
            }
        }
        function setCustomBet(val) { currentBets.slots = parseInt(val) || 100; document.getElementById("current-bet-display").textContent = currentBets.slots; }
        function setCustomBetGeneric(game, val) { currentBets[game] = parseInt(val) || 1000; }

        // === –ò–ì–†–ê: –°–õ–û–¢–´ ===
        function openSlotsModal() {
            document.getElementById("slots-modal").classList.remove("hidden");
            document.getElementById("slots-result").innerHTML = "";
            [1,2,3].forEach(i => document.getElementById(`reel${i}`).innerHTML = `<img src="${symbols[0].url}" class="w-full h-full object-contain">`);
        }

        function spinSlots() {
            if(user.balance < currentBets.slots) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            user.balance -= currentBets.slots;
            addXp(currentBets.slots);
            saveUser();

            const btn = document.getElementById("spin-button");
            btn.disabled = true;
            btn.classList.add("opacity-50");
            document.getElementById("slots-result").textContent = "";

            // –®–∞–Ω—Å—ã: 8% –¥–∂–µ–∫–ø–æ—Ç, 25% –ø–∞—Ä–∞
            let r = Math.random();
            let res = [];
            if(r < 0.08) res = [0,0,0]; 
            else if(r < 0.33) res = [0,0,1];
            else res = [0,1,2];
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Ç–∏–ø—ã —Å–∏–º–≤–æ–ª–æ–≤
            const map = [0,1,2].sort(()=>Math.random()-0.5);
            const final = res.map(i => symbols[map[i]]); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫ –ø–∞—Ç—Ç–µ—Ä–Ω—É

            [1,2,3].forEach((reel, i) => {
                const el = document.getElementById(`reel${reel}`);
                let count = 0;
                let interval = setInterval(() => {
                    el.innerHTML = `<img src="${symbols[Math.floor(Math.random()*3)].url}" class="w-full h-full object-contain blur-[2px]">`;
                    count++;
                    if(count > 10 + (i*5)) {
                        clearInterval(interval);
                        el.innerHTML = `<img src="${final[i].url}" class="w-full h-full object-contain">`;
                        if(i===2) checkSlotsWin(final);
                    }
                }, 80);
            });
        }

        function checkSlotsWin(res) {
            const btn = document.getElementById("spin-button");
            btn.disabled = false;
            btn.classList.remove("opacity-50");
            
            const isJackpot = res[0].name === res[1].name && res[1].name === res[2].name;
            const isPair = res[0].name === res[1].name || res[1].name === res[2].name || res[0].name === res[2].name;
            
            const div = document.getElementById("slots-result");
            
            if(isJackpot) {
                const win = currentBets.slots * 15;
                user.balance += win;
                div.innerHTML = `<span class="text-emerald-400">–î–ñ–ï–ö–ü–û–¢! +${win}</span>`;
            } else if(isPair) {
                const win = currentBets.slots * 2;
                user.balance += win;
                div.innerHTML = `<span class="text-emerald-400">–ü–ê–†–ê! +${win}</span>`;
            } else {
                div.innerHTML = `<span class="text-zinc-500">–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ...</span>`;
            }
            saveUser();
        }

        // === –ò–ì–†–ê: –≠–ü–®–¢–ï–ô–ù ===
        function openEpsteinModal() {
            if(user.level < 5) return;
            document.getElementById("epstein-modal").classList.remove("hidden");
            resetEpstein();
        }

        function resetEpstein() {
            epsteinState = { active: false, winnings: 0, bet: 0 };
            document.getElementById("epstein-grid").innerHTML = "";
            document.getElementById("epstein-controls").querySelector("button:last-child").classList.remove("hidden"); // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—Ç
            document.getElementById("epstein-cashout-ui").classList.add("hidden");
            
            // –†–∏—Å—É–µ–º –ø—É—Å—Ç—É—é —Å–µ—Ç–∫—É
            for(let i=0; i<16; i++) {
                const d = document.createElement("div");
                d.className = "bg-zinc-800 rounded-xl border border-zinc-700 flex items-center justify-center text-zinc-600";
                d.innerHTML = '<i class="fas fa-question"></i>';
                document.getElementById("epstein-grid").appendChild(d);
            }
        }

        function startEpstein() {
            if(user.balance < currentBets.epstein) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
            user.balance -= currentBets.epstein;
            addXp(currentBets.epstein);
            saveUser();

            epsteinState.active = true;
            epsteinState.bet = currentBets.epstein;
            
            // UI –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
            document.getElementById("epstein-controls").querySelector("button:last-child").classList.add("hidden");
            document.getElementById("epstein-cashout-ui").classList.remove("hidden");
            document.getElementById("epstein-win-amount").textContent = "0";

            const grid = document.getElementById("epstein-grid");
            grid.innerHTML = "";
            
            // 3 –ë–æ–º–±—ã, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –¥–µ–Ω—å–≥–∏
            let types = Array(3).fill("bomb").concat(Array(13).fill("safe")).sort(()=>Math.random()-0.5);

            types.forEach(type => {
                const btn = document.createElement("button");
                btn.className = "bg-zinc-800 rounded-xl border border-zinc-700 flex items-center justify-center text-xl hover:border-pink-500 transition active:scale-95";
                btn.innerHTML = "üå¥";
                btn.onclick = () => clickEpstein(btn, type);
                grid.appendChild(btn);
            });
        }

        function clickEpstein(btn, type) {
            if(!epsteinState.active || btn.disabled) return;
            btn.disabled = true;

            if(type === "bomb") {
                btn.className = "bg-red-900 border-red-500 rounded-xl flex items-center justify-center text-2xl animate-pulse";
                btn.innerHTML = "üí£";
                epsteinState.active = false;
                setTimeout(() => {
                    alert("–í–ê–° –ü–û–ô–ú–ê–õ–ò! –î–µ–Ω—å–≥–∏ —Å–≥–æ—Ä–µ–ª–∏.");
                    resetEpstein();
                }, 300);
            } else {
                // –í—ã–∏–≥—Ä—ã—à –æ—Ç 50% –¥–æ 150% —Å—Ç–∞–≤–∫–∏ –∑–∞ –∫–ª–µ—Ç–∫—É (—É–≤–µ–ª–∏—á–∏–ª –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å)
                const prize = Math.floor(epsteinState.bet * (Math.random() + 0.5));
                epsteinState.winnings += prize;
                document.getElementById("epstein-win-amount").textContent = epsteinState.winnings.toLocaleString();
                
                btn.className = "bg-emerald-900 border-emerald-500 rounded-xl flex flex-col items-center justify-center";
                btn.innerHTML = `<span class="text-xs text-emerald-300">+${Math.floor(prize/1000)}k</span>`;
            }
        }

        function cashoutEpstein() {
            if(!epsteinState.active) return;
            user.balance += epsteinState.winnings;
            alert(`–í—ã–≤–µ–ª–∏: ${epsteinState.winnings} ‚ÇΩ`);
            saveUser();
            resetEpstein();
        }

        // === –ò–ì–†–ê: BEAST CRASH (CANVAS) ===
        function openBeastModal() {
            if(user.level < 10) return;
            document.getElementById("beast-modal").classList.remove("hidden");
            resizeCanvas();
            resetBeastUI();
        }

        function resetBeastUI() {
            const btn = document.getElementById("beast-action-btn");
            btn.textContent = "–°–¢–ê–†–¢";
            btn.classList.remove("bg-emerald-500");
            btn.classList.add("bg-blue-600");
            btn.disabled = false;
            document.getElementById("crash-multiplier").className = "text-4xl font-bold text-white drop-shadow-md";
            document.getElementById("crash-overlay").classList.add("hidden");
            drawBeastIdle();
        }

        function drawBeastIdle() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
            for(let i=0; i<canvas.height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
            ctx.stroke();
            
            // –†–∞–∫–µ—Ç–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
            ctx.drawImage(rocketImg, 10, canvas.height - 60, 50, 50);
        }

        function startBeast() {
            if(beastState.active) {
                beastCashout();
                return;
            }

            if(user.balance < currentBets.beast) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
            user.balance -= currentBets.beast;
            beastState.bet = currentBets.beast;
            addXp(currentBets.beast);
            saveUser();

            // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
            beastState.active = true;
            beastState.crashed = false;
            beastState.multiplier = 1.00;
            beastState.startTime = Date.now();
            graphPoints = [{x: 0, y: canvas.height}]; // –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞

            // –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –≤—ã–≤–æ–¥
            const btn = document.getElementById("beast-action-btn");
            btn.textContent = "–ó–ê–ë–†–ê–¢–¨";
            btn.classList.remove("bg-blue-600");
            btn.classList.add("bg-emerald-500");

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ—á–∫—É –∫—Ä–∞—à–∞
            // –õ–æ–≥–∏–∫–∞: —á–∞—â–µ –≤—Å–µ–≥–æ –∫—Ä–∞—à–∏—Ç—Å—è —Ä–∞–Ω–æ, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ª–µ—Ç–∏—Ç –¥–∞–ª–µ–∫–æ
            // E = -ln(U) / lambda. –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ü–∞—Ä–µ—Ç–æ
            let crashPoint = 1 / (1 - Math.random());
            // –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —á—Ç–æ–±—ã –Ω–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ —É–ª–µ—Ç–∞–ª–æ –≤ –∫–æ—Å–º–æ—Å
            if (crashPoint > 50) crashPoint = 50; 
            if (Math.random() < 0.3) crashPoint = 1.0 + Math.random() * 0.4; // 30% —Ä–∞–Ω–Ω–∏—Ö –∫—Ä–∞—à–µ–π

            requestAnimationFrame((ts) => gameLoop(ts, crashPoint));
        }

        function gameLoop(timestamp, crashPoint) {
            if(!beastState.active) return;

            // –†–æ—Å—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π)
            let elapsed = (Date.now() - beastState.startTime) / 1000; // —Å–µ–∫—É–Ω–¥—ã
            beastState.multiplier = 1.0 + (elapsed * elapsed * 0.1) + (elapsed * 0.05);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            document.getElementById("crash-multiplier").textContent = beastState.multiplier.toFixed(2) + "x";

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—à–∞
            if(beastState.multiplier >= crashPoint) {
                triggerCrash(crashPoint);
                return;
            }

            // –†–∏—Å—É–µ–º
            drawGraph(elapsed);

            requestAnimationFrame(() => gameLoop(timestamp, crashPoint));
        }

        function drawGraph(elapsed) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#27272a'; // zinc-800
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let i=0; i<canvas.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
            for(let i=0; i<canvas.height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
            ctx.stroke();

            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ä–∞–∫–µ—Ç—ã
            // X –ª–∏–Ω–µ–π–Ω–æ, Y –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–µ (–Ω–æ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ç.–∫. canvas Y=0 –Ω–∞–≤–µ—Ä—Ö—É)
            let x = elapsed * 40; 
            let y = canvas.height - (elapsed * elapsed * 10) - 20;

            // –ï—Å–ª–∏ –≤—ã–ª–µ—Ç–µ–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã, —Å–¥–≤–∏–≥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
            let scaleX = 1;
            let scaleY = 1;

            if (x > canvas.width - 60) {
                scaleX = (canvas.width - 60) / x;
            }
            if (y < 20) {
                // –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ, –Ω–µ —Å–∂–∏–º–∞–µ–º —Å–∏–ª—å–Ω–æ, –ø—Ä–æ—Å—Ç–æ —Ä–∞–∫–µ—Ç–∞ —É—Ö–æ–¥–∏—Ç –≤ –ø–æ—Ç–æ–ª–æ–∫ (–∏–ª–∏ —Å–∫–µ–π–ª–∏–º Y)
                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Å–∫–µ–π–ª–∏–º –≤—Å–µ —Ç–æ—á–∫–∏
                scaleY = (canvas.height - 50) / (canvas.height - y);
            }

            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é
            ctx.beginPath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#3b82f6'; // blue-500
            ctx.lineCap = 'round';
            ctx.moveTo(0, canvas.height); // –°—Ç–∞—Ä—Ç
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç–æ—á–µ–∫ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–π –∫—Ä–∏–≤–æ–π,
            // –Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∏—Å—É–µ–º –∫—Ä–∏–≤—É—é –ë–µ–∑—å–µ "–Ω–∞ –ª–µ—Ç—É" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ª–∏–Ω–∏—é –∫ —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–µ
            // –î–ª—è –∫—Ä–∞—Å–æ—Ç—ã –Ω–∞—Ä–∏—Å—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—É—é –∫—Ä–∏–≤—É—é –æ—Ç 0,H –¥–æ —Ç–µ–∫ X,Y
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º scale –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            let drawX = x * scaleX;
            let drawY = canvas.height - ((canvas.height - y) * scaleX); // –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –∑—É–º –ø–æ X

            ctx.quadraticCurveTo(drawX / 2, canvas.height, drawX, drawY);
            ctx.stroke();

            // –†–∏—Å—É–µ–º –†–∞–∫–µ—Ç—É
            ctx.save();
            ctx.translate(drawX, drawY);
            // –£–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ - –ø—Ä–∏–º–µ—Ä–Ω–æ 45 –≥—Ä–∞–¥—É—Å–æ–≤ –∏–ª–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—Ä—É—Ç–∏–∑–Ω—ã
            let angle = -45 * Math.PI / 180;
            ctx.rotate(angle);
            ctx.drawImage(rocketImg, -25, -25, 50, 50); // —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
            ctx.restore();
        }

        function triggerCrash(val) {
            beastState.active = false;
            beastState.crashed = true;
            
            document.getElementById("crash-multiplier").className = "text-4xl font-bold text-red-600 z-10";
            document.getElementById("crash-final-val").textContent = val.toFixed(2);
            document.getElementById("crash-overlay").classList.remove("hidden");
            
            const btn = document.getElementById("beast-action-btn");
            btn.textContent = "–í–ó–†–´–í!";
            btn.classList.remove("bg-emerald-500");
            btn.classList.add("bg-red-600");
            btn.disabled = true;

            setTimeout(resetBeastUI, 3000);
        }

        function beastCashout() {
            if(!beastState.active || beastState.crashed) return;
            beastState.active = false;
            
            const win = Math.floor(beastState.bet * beastState.multiplier);
            user.balance += win;
            saveUser();

            document.getElementById("crash-multiplier").className = "text-4xl font-bold text-emerald-400 z-10";
            
            const btn = document.getElementById("beast-action-btn");
            btn.textContent = `+${win} ‚ÇΩ`;
            btn.disabled = true;
            
            setTimeout(resetBeastUI, 2000);
        }

    </script>
</body>
</html>
